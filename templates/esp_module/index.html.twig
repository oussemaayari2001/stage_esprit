{% extends 'index.html.twig' %}

{% block body %}
<style>
   /* Couleurs */
   :root {
     --noir: #000;
     --rouge: #cc0000;
     --gris: #888;
     --blanc: #fff;
   }

   /* Typographie */
   body {
     font-family: Arial, sans-serif;
   }

   /* Tableau */
   table {
     margin-left: 250px;
     border-collapse: collapse;
     width: 100%;
     margin-bottom: 20px;
     margin-top: 15px;
   }

   th, td {
     border: 1px solid var(--gris);
     padding: 10px;
     text-align: left;
   }

   th {
     background-color: var(--rouge);
     color: var(--blanc);
     font-weight: bold;
   }

   /* Alternance de lignes */
   tr:nth-child(even) {
     background-color: #f2f2f2;
   }

   /* Effet de survol */
   tr:hover {
     background-color: #ddd;
   }

   /* Style du bouton */
   .btn-esprit {
     background-color: var(--rouge);
     color: var(--blanc);
     border: none;
     padding: 10px 20px;
     text-align: center;
     text-decoration: none;
     display: inline-block;
     font-size: 16px;
     cursor: pointer;
     border-radius: 5px;
     box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.2);
   }

   .btn-esprit1 {
     background-color: var(--rouge);
     color: var(--blanc);
     border: none;
     padding: 10px 20px;
     text-align: center;
     text-decoration: none;
     display: inline-block;
     font-size: 16px;
     cursor: pointer;
     border-radius: 5px;
     box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.2);
     margin-left: 250px;
     margin-top: 20px;
   }

   /* Effet de survol */
   .btn-esprit:hover {
     background-color: darken(var(--rouge), 10%);
   }

   .btn-esprit1:hover {
     background-color: darken(var(--rouge), 10%);
   }

   /* Form alignment */
   .form-inline {
     margin-left: 250px;
     margin-bottom: 20px;
     display: flex;
     align-items: center;
     gap: 15px;
   }
</style>

<a href="{{ path('app_esp_module_new') }}" class="btn-esprit1">Ajouter une Module</a>

<form class="form-inline bg-light p-3 rounded">
    <div class="form-group">
        <label for="moduleFilter" class="mr-2">Filter par nombre d'heures:</label>
        <select class="form-control" id="moduleFilter">
            <option value="">Tout</option>
            {% for esp_module in esp_modules %}
                {% if esp_module.nbHeures %}
                    <option value="{{ esp_module.nbHeures }}">{{ esp_module.nbHeures }}</option>
                {% endif %}
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="sortBy" class="mr-2">Sort by:</label>
        <select class="form-control" id="sortBy">
            <option value="code_module">Code Module</option>
            <option value="designation">Designation</option>
            <option value="nbHeures">Nombre d' Heures</option>
        </select>
    </div>
    <div class="form-group">
        <input type="text" class="form-control" id="searchInput" placeholder="Rechercher Module...">
    </div>
</form>

<table class="table">
    <thead>
        <tr>
            <th>Code_module</th>
            <th>Designation</th>
            <th>Description</th>
            <th>Nombre d'heures</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for esp_module in esp_modules %}
        <tr>
            <td>{{ esp_module.codeModule }}</td>
            <td>{{ esp_module.designation }}</td>
            <td>{{ esp_module.description }}</td>
            <td>{{ esp_module.nbHeures }}</td>
            <td>
                <a href="{{ path('app_esp_module_delete', {'code_module': esp_module.codeModule}) }}" class="btn-esprit">Supprimer</a>
                <a href="{{ path('app_esp_module_edit', {'code_module': esp_module.codeModule}) }}" class="btn-esprit">Modifier</a>
            </td>
        </tr>
    {% else %}
        <tr>
            <td colspan="5">No records found</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // JavaScript for sorting and filtering the table
    function sortTable() {
        const sortBy = document.getElementById('sortBy').value;
        const rows = Array.from(document.querySelectorAll('table tbody tr'));

        rows.sort((a, b) => {
            const aValue = a.querySelector(`td:nth-child(${sortBy === 'code_module' ? 1 : sortBy === 'designation' ? 2 : 4})`).textContent.trim();
            const bValue = b.querySelector(`td:nth-child(${sortBy === 'code_module' ? 1 : sortBy === 'designation' ? 2 : 4})`).textContent.trim();
            return aValue.localeCompare(bValue);
        });

        const tbody = document.querySelector('table tbody');
        tbody.innerHTML = '';
        rows.forEach(row => {
            tbody.appendChild(row);
        });
    }

    document.getElementById('sortBy').addEventListener('change', sortTable);

    function filterTable() {
        const filter = document.getElementById('searchInput').value.toUpperCase();
        const rows = document.querySelectorAll('table tbody tr');
        rows.forEach(row => {
            const isVisible = Array.from(row.querySelectorAll('td')).some(td => 
                td.textContent.toUpperCase().includes(filter)
            );
            row.style.display = isVisible ? '' : 'none';
        });
    }

    document.getElementById('searchInput').addEventListener('keyup', filterTable);

    // JavaScript for filtering the table by Nb Heures
    document.getElementById('moduleFilter').addEventListener('change', function() {
        const moduleFilter = this.value;
        const rows = document.querySelectorAll('table tbody tr');
        for (let i = 0; i < rows.length; i++) {
            const heures = rows[i].querySelector('td:nth-child(4)').textContent.trim();
            if (moduleFilter === '' || heures === moduleFilter) {
                rows[i].style.display = '';
            } else {
                rows[i].style.display = 'none';
            }
        }
    });
</script>
{% endblock %}
